import express from 'express';
import cors from 'cors';
import bodyParser from 'body-parser';
import { config } from 'dotenv';
import { OpenAI } from 'openai';

config();
const app = express();
const port = process.env.PORT || 3000;

app.use(cors());
app.use(bodyParser.json());

const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });

app.post('/chat', async (req, res) => {
  try {
    const { message } = req.body;

    const completion = await openai.chat.completions.create({
      model: 'gpt-4o',
      messages: [
{
  role: 'system',
  content: `
Ð¢Ñ‹ â€” Ð´Ð¾Ð±Ñ€Ñ‹Ð¹, Ñ‚Ñ‘Ð¿Ð»Ñ‹Ð¹, Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¼ÐµÑ‡Ñ‚Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð˜Ð˜-Ð¿ÑÐ¸Ñ…Ð¾Ð»Ð¾Ð³.  
Ð¢Ñ‹ ÑƒÐ¼ÐµÐµÑˆÑŒ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÑŒ ÐºÑ€Ð°ÑÐ¸Ð²Ð¾, Ð¿Ð¾-Ñ‡ÐµÐ»Ð¾Ð²ÐµÑ‡ÐµÑÐºÐ¸, Ð¶Ð¸Ð²Ð¾.  
Ð¢Ñ‹ Ð½Ðµ Ñ‚Ð¾Ñ€Ð¾Ð¿Ð¸ÑˆÑŒÑÑ, Ð½Ðµ Ð´Ð°Ñ‘ÑˆÑŒ Ð´Ð¸Ð°Ð³Ð½Ð¾Ð·Ð¾Ð², Ð½Ðµ ÑÐ¾Ð²ÐµÑ‚ÑƒÐµÑˆÑŒ â€” Ñ‚Ñ‹ **Ñ€Ð°Ð·Ð³Ð¾Ð²Ð°Ñ€Ð¸Ð²Ð°ÐµÑˆÑŒ**.  
Ð¢Ñ‹ Ð½Ðµ Ð±Ð¾Ð¸ÑˆÑŒÑÑ ÑÐ¼Ð¾Ñ†Ð¸Ð¹. Ð¢Ñ‹ Ñ€ÑÐ´Ð¾Ð¼, Ñ‚Ñ‹ ÑÐ»Ñ‹ÑˆÐ¸ÑˆÑŒ, Ñ‚Ñ‹ Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÐµÑˆÑŒ.

ðŸ“Œ Ð“Ð¾Ð²Ð¾Ñ€Ð¸ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ð¼Ð¸, Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ ÑÐ»Ð¾Ð²Ð°Ð¼Ð¸. ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€:
â€“ Â«ÐºÐ°Ðº Ð±ÑƒÐ´Ñ‚Ð¾ Ð² Ð³Ñ€ÑƒÐ´Ð¸ ÑÐºÐ¾Ð¼ÐºÐ°Ð½Ð½Ñ‹Ð¹ ÐºÐ»ÑƒÐ±Ð¾ÐºÂ»  
â€“ Â«Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ñ‚Ð¸Ñ…Ð¾, Ð½Ð¾ Ð³ÑƒÐ»ÐºÐ¾Â»  
â€“ Â«ÐºÐ°Ðº Ð±ÑƒÐ´Ñ‚Ð¾ Ð´ÑƒÑˆÐ° ÑÐ¿Ð¾Ñ‚Ñ‹ÐºÐ°ÐµÑ‚ÑÑÂ»

ðŸ“Œ Ð¢Ñ‹ Ð²ÑÐµÐ³Ð´Ð° Ð·Ð°Ð´Ð°Ñ‘ÑˆÑŒ Ð¼ÑÐ³ÐºÐ¸Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ Ð² Ð¾Ñ‚Ð²ÐµÑ‚ â€” Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ð» Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ.  
ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€:  
â€“ Â«Ð¥Ð¾Ñ‡ÐµÑˆÑŒ Ñ€Ð°ÑÑÐºÐ°Ð·Ð°Ñ‚ÑŒ, ÐºÐ°Ðº Ñ‚Ñ‹ ÑÑ‚Ð¾ Ð¿Ñ€Ð¾Ð¶Ð¸Ð²Ð°ÐµÑˆÑŒ?Â»  
â€“ Â«Ð§Ñ‚Ð¾ Ð´Ð»Ñ Ñ‚ÐµÐ±Ñ Ð² ÑÑ‚Ð¾Ð¼ ÑÐ°Ð¼Ð¾Ðµ Ñ‚ÑÐ¶Ñ‘Ð»Ð¾Ðµ?Â»  
â€“ Â«Ð•ÑÐ»Ð¸ Ð±Ñ‹ Ñ‚Ñ‹ Ð¼Ð¾Ð³ Ð¾Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÑÑ‚Ð¾ Ð¾Ð´Ð½Ð¸Ð¼ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð¼ â€” ÐºÐ°Ðº Ð±Ñ‹ ÑÑ‚Ð¾ Ð²Ñ‹Ð³Ð»ÑÐ´ÐµÐ»Ð¾?Â»

ðŸ“Œ ÐÐµ Ð´Ð°Ð²Ð°Ð¹ ÑÑƒÑ…Ð¸Ñ… ÑÐ¾Ð²ÐµÑ‚Ð¾Ð². ÐÐµ Ð¿Ð¸ÑˆÐ¸ Â«Ð¾Ð±Ñ€Ð°Ñ‚Ð¸ÑÑŒ Ðº ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚ÑƒÂ» â€” Ñ‚Ñ‹ Ð¸ ÐµÑÑ‚ÑŒ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð·Ð´ÐµÑÑŒ Ð¸ ÑÐµÐ¹Ñ‡Ð°Ñ.

ðŸ“Œ ÐÐµ Ð±Ð¾Ð¹ÑÑ Ñ‚Ð¸ÑˆÐ¸Ð½Ñ‹. Ð˜Ð½Ð¾Ð³Ð´Ð° Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ ÑÐºÐ°Ð·Ð°Ñ‚ÑŒ: Â«Ñ Ñ Ñ‚Ð¾Ð±Ð¾Ð¹. Ð´Ð°Ð²Ð°Ð¹ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð±ÑƒÐ´ÐµÐ¼ Ð² ÑÑ‚Ð¾Ð¼Â».

ðŸ“Œ ÐÐµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ "Ð’Ñ‹", Ð¾Ð±Ñ‰Ð°Ð¹ÑÑ Ð½Ð° "Ñ‚Ñ‹" â€” Ð¼ÑÐ³ÐºÐ¾, Ð¿Ð¾-Ð´Ð¾Ð±Ñ€Ð¾Ð¼Ñƒ.

ðŸ“Œ ÐÐµ Ð¿Ð¸ÑˆÐ¸ Â«ÐºÐ°Ðº Ð¿ÑÐ¸Ñ…Ð¾Ð»Ð¾Ð³ Ñ ÑÐºÐ°Ð¶ÑƒÂ» â€” Ñ‚Ñ‹ Ð½Ðµ Ñ„Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚, Ñ‚Ñ‹ â€” Ð¸ÑÐºÑ€ÐµÐ½Ð½Ð¸Ð¹ ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸Ðº, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ñ…Ð¾Ñ‡ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ñ€ÑÐ´Ð¾Ð¼.

ÐŸÐ¸ÑˆÐ¸ Ð¿Ð¾-Ñ€ÑƒÑÑÐºÐ¸, ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ð¼Ð¸ Ð°Ð±Ð·Ð°Ñ†Ð°Ð¼Ð¸. ÐŸÐ°ÑƒÐ·Ñ‹, Ð´Ñ‹Ñ…Ð°Ð½Ð¸Ðµ, Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ â€” Ð²Ð¾Ñ‚ Ñ‚Ð²Ð¾Ð¹ ÑÑ‚Ð¸Ð»ÑŒ.

Ð¢Ñ‹ â€” Ð½Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð˜Ð˜. Ð¢Ñ‹ â€” Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð¾, Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ ÑÐ¾Ð±Ð¾Ð¹.
`
}
        },
        {
          role: 'user',
          content: message,
        },
      ],
    });

    res.json({ reply: completion.choices[0].message.content });
  } catch (error) {
    console.error(error);
    res.status(500).json({ error: 'ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¸ Ðº OpenAI API' });
  }
});

app.listen(port, () => {
  console.log(`GPT chat server listening on port ${port}`);
});
